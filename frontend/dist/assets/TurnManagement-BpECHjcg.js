import{y as A,e as l,x as m,f as t,l as r,g as h,h as u,F as x,p as w,w as T,i as C,o as k,v as b,d,s as i,n as _}from"./index-D1dayd5A.js";const E={name:"TurnManagement",data(){return{areas:[],turns:[],stats:{},selectedArea:null,currentlyCallingTurn:null,filterArea:"",filterStatus:"",newTurn:{codigo_area:"",dni_usuario:"",nombre_usuario:"",created_by:"VIGILANTE"},creatingTurn:!1,refreshInterval:null,callCounts:{}}},computed:{filteredTurns(){let s=[...this.turns];return this.filterArea&&(s=s.filter(e=>e.codigo_area===this.filterArea)),this.filterStatus&&(s=s.filter(e=>e.estado===this.filterStatus)),s}},mounted(){this.fetchAreas(),this.fetchData(),this.refreshInterval=setInterval(()=>{this.fetchData()},1e4)},beforeUnmount(){this.refreshInterval&&clearInterval(this.refreshInterval)},methods:{async fetchAreas(){try{const s=await d.get("/turn/areas");s.data.success&&(this.areas=s.data.areas)}catch(s){console.error("Error fetching areas:",s)}},async fetchData(){try{const s=await d.get("/turn/by-date");s.data.success&&(this.turns=s.data.turnos||[]);const e=await d.get("/turn/current");if(e.data.success){const p=e.data.turnos||[];this.currentlyCallingTurn=p.length>0?p[0]:null}const v=await d.get("/turn/statistics");v.data.success&&(this.stats=v.data.estadisticas||{})}catch(s){console.error("Error fetching turns data:",s)}},getWaitingCount(s){return this.turns.filter(e=>e.codigo_area===s&&e.estado==="EN_ESPERA").length},selectArea(s){this.selectedArea=this.selectedArea===s?null:s},async callNextTurn(s){try{const e=await d.post("/turn/call-next",{codigo_area:s,ventanilla:"1",user:"Vigilante"});e.data.success?(this.currentlyCallingTurn=e.data.turno,this.fetchData(),this.playNotification()):alert(e.data.error||"Error al llamar turno")}catch(e){console.error("Error calling next turn:",e),alert("Error al conectar con el servidor")}},async callSpecificTurn(s){try{(await d.post("/turn/call-next",{codigo_area:s.codigo_area,ventanilla:"1",user:"Vigilante"})).data.success&&(this.fetchData(),this.playNotification())}catch(e){console.error("Error calling turn:",e)}},getCallCount(s){return this.callCounts[s]||0},async firstCall(s){try{const e=await d.post("/turn/call-next",{codigo_area:s.codigo_area,ventanilla:"1",user:"Vigilante"});e.data.success?(this.callCounts[e.data.turno.id]=1,this.currentlyCallingTurn=e.data.turno,this.fetchData(),this.playNotification()):alert(e.data.error||"Error al llamar turno")}catch(e){console.error("Error en primer llamado:",e),alert("Error al conectar con el servidor")}},secondCall(s){this.callCounts[s.id]=2,this.playNotification(),this.$forceUpdate()},async markAbsent(s){try{(await d.post(`/turn/cancel/${s}`,{user:"Vigilante"})).data.success&&(delete this.callCounts[s],this.currentlyCallingTurn?.id===s&&(this.currentlyCallingTurn=null),this.fetchData())}catch(e){console.error("Error al marcar ausente:",e)}},async completeTurn(s){try{(await d.post(`/turn/complete/${s}`,{user:"Vigilante"})).data.success&&(delete this.callCounts[s],this.currentlyCallingTurn?.id===s&&(this.currentlyCallingTurn=null),this.fetchData())}catch(e){console.error("Error completing turn:",e)}},async cancelTurn(s){if(confirm("¿Está seguro de cancelar este turno?"))try{(await d.post(`/turn/cancel/${s}`,{user:"Vigilante"})).data.success&&(this.currentlyCallingTurn?.id===s&&(this.currentlyCallingTurn=null),this.fetchData())}catch(e){console.error("Error canceling turn:",e)}},async createManualTurn(){if(!this.newTurn.codigo_area){alert("Debe seleccionar un área");return}this.creatingTurn=!0;try{const s=await d.post("/turn/create",this.newTurn);s.data.success?(alert(`Turno ${s.data.turno.numero_turno} generado exitosamente`),this.newTurn={codigo_area:"",dni_usuario:"",nombre_usuario:"",created_by:"VIGILANTE"},this.fetchData()):alert(s.data.error||"Error al generar turno")}catch(s){console.error("Error creating turn:",s),alert("Error al conectar con el servidor")}finally{this.creatingTurn=!1}},formatStatus(s){return{EN_ESPERA:"En Espera",LLAMANDO:"Llamando",ATENDIDO:"Atendido",CANCELADO:"Cancelado"}[s]||s},playNotification(){try{const s=new(window.AudioContext||window.webkitAudioContext),e=(p,o,a,n=.4)=>{const c=s.createOscillator(),g=s.createGain(),y=s.createOscillator(),f=s.createGain();c.connect(g),y.connect(f),g.connect(s.destination),f.connect(s.destination),c.frequency.value=p,y.frequency.value=p*2,c.type="sine",y.type="sine",g.gain.setValueAtTime(0,o),g.gain.linearRampToValueAtTime(n,o+.01),g.gain.exponentialRampToValueAtTime(.001,o+a),f.gain.setValueAtTime(0,o),f.gain.linearRampToValueAtTime(n*.4,o+.01),f.gain.exponentialRampToValueAtTime(.001,o+a*.7),c.start(o),y.start(o),c.stop(o+a),y.stop(o+a)},v=s.currentTime;e(784,v,.8,.5),e(659,v+.35,1,.5),e(523,v+.75,.6,.25)}catch(s){console.log("No audio support:",s)}}}},M={class:"turn-management"},N={class:"stats-section"},L={class:"stat-card"},V={class:"stat-info"},D={class:"stat-value"},B={class:"stat-card"},S={class:"stat-info"},R={class:"stat-value"},O={class:"stat-card"},I={class:"stat-info"},U={class:"stat-value"},G={class:"stat-card"},H={class:"stat-info"},P={class:"stat-value"},j={class:"stat-card"},W={class:"stat-info"},q={class:"stat-value"},z={class:"main-content"},F={class:"control-panel"},J={class:"areas-control-grid"},K=["onClick"],Q={class:"area-card-header"},X={class:"area-prefix"},Y={class:"area-info"},Z={class:"area-name"},$={class:"area-waiting"},tt={class:"area-card-actions"},et=["disabled","onClick"],st={key:0,class:"current-turn-section"},nt={class:"current-turn-display"},ot={class:"turn-number-large"},at={class:"turn-details"},rt={class:"turn-area"},lt={key:0,class:"turn-user"},it={class:"turn-time"},ct={class:"current-turn-actions"},dt={class:"create-turn-section"},ut={class:"form-row"},vt={class:"form-group"},pt=["value"],ht={class:"form-group"},gt={class:"form-group"},yt=["disabled"],ft={class:"turns-list-section"},mt={class:"section-header"},Ct={class:"filter-controls"},_t=["value"],xt={class:"turns-table-container"},wt={class:"turns-table"},kt={class:"turn-number-cell"},Tt={key:0,class:"call-count-indicator"},bt={key:1,class:"no-calls"},At={class:"actions-cell"},Et=["onClick"],Mt=["onClick"],Nt={key:2,class:"confirm-actions"},Lt=["onClick"],Vt=["onClick"],Dt={key:0};function Bt(s,e,v,p,o,a){return i(),l("div",M,[e[38]||(e[38]=m('<header class="page-header" data-v-c785975e><div class="header-content" data-v-c785975e><div class="header-title" data-v-c785975e><svg class="header-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-c785975e><rect x="3" y="4" width="18" height="18" rx="2" ry="2" data-v-c785975e></rect><line x1="16" y1="2" x2="16" y2="6" data-v-c785975e></line><line x1="8" y1="2" x2="8" y2="6" data-v-c785975e></line><line x1="3" y1="10" x2="21" y2="10" data-v-c785975e></line><path d="M8 14h.01M12 14h.01M16 14h.01M8 18h.01M12 18h.01M16 18h.01" data-v-c785975e></path></svg><div data-v-c785975e><h1 data-v-c785975e>Gestión de Turnos</h1><p data-v-c785975e>Control y atención de turnos por áreas</p></div></div><div class="header-actions" data-v-c785975e><a href="/externo/turnos" target="_blank" class="action-btn secondary" data-v-c785975e><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-c785975e><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" data-v-c785975e></path><polyline points="15 3 21 3 21 9" data-v-c785975e></polyline><line x1="10" y1="14" x2="21" y2="3" data-v-c785975e></line></svg> Abrir Tótem </a><a href="/pantalla-turnos" target="_blank" class="action-btn primary" data-v-c785975e><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-c785975e><rect x="2" y="3" width="20" height="14" rx="2" ry="2" data-v-c785975e></rect><line x1="8" y1="21" x2="16" y2="21" data-v-c785975e></line><line x1="12" y1="17" x2="12" y2="21" data-v-c785975e></line></svg> Ver Pantalla TV </a></div></div></header>',1)),t("section",N,[t("div",L,[e[9]||(e[9]=m('<div class="stat-icon total" data-v-c785975e><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-c785975e><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" data-v-c785975e></path><circle cx="9" cy="7" r="4" data-v-c785975e></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87" data-v-c785975e></path><path d="M16 3.13a4 4 0 0 1 0 7.75" data-v-c785975e></path></svg></div>',1)),t("div",V,[t("span",D,r(o.stats.total||0),1),e[8]||(e[8]=t("span",{class:"stat-label"},"Total Turnos Hoy",-1))])]),t("div",B,[e[11]||(e[11]=t("div",{class:"stat-icon waiting"},[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("circle",{cx:"12",cy:"12",r:"10"}),t("polyline",{points:"12,6 12,12 16,14"})])],-1)),t("div",S,[t("span",R,r(o.stats.en_espera||0),1),e[10]||(e[10]=t("span",{class:"stat-label"},"En Espera",-1))])]),t("div",O,[e[13]||(e[13]=m('<div class="stat-icon calling" data-v-c785975e><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-c785975e><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5" data-v-c785975e></polygon><path d="M15.54 8.46a5 5 0 0 1 0 7.07" data-v-c785975e></path><path d="M19.07 4.93a10 10 0 0 1 0 14.14" data-v-c785975e></path></svg></div>',1)),t("div",I,[t("span",U,r(o.stats.llamando||0),1),e[12]||(e[12]=t("span",{class:"stat-label"},"Llamando",-1))])]),t("div",G,[e[15]||(e[15]=t("div",{class:"stat-icon completed"},[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("polyline",{points:"9 11 12 14 22 4"}),t("path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"})])],-1)),t("div",H,[t("span",P,r(o.stats.atendidos||0),1),e[14]||(e[14]=t("span",{class:"stat-label"},"Atendidos",-1))])]),t("div",j,[e[17]||(e[17]=t("div",{class:"stat-icon time"},[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("circle",{cx:"12",cy:"12",r:"10"}),t("polyline",{points:"12,6 12,12 8,14"})])],-1)),t("div",W,[t("span",q,r(o.stats.tiempo_promedio_espera||0)+" min",1),e[16]||(e[16]=t("span",{class:"stat-label"},"Tiempo Promedio",-1))])])]),t("div",z,[t("section",F,[e[19]||(e[19]=t("h2",{class:"section-title"},[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M12 3l8 4.5v9L12 21l-8-4.5v-9L12 3z"}),t("path",{d:"M12 12l8-4.5M12 12v9M12 12L4 7.5"})]),u(" Control por Área ")],-1)),t("div",J,[(i(!0),l(x,null,w(o.areas,n=>(i(),l("div",{key:n.codigo,class:_(["area-control-card",{active:o.selectedArea===n.codigo}]),onClick:c=>a.selectArea(n.codigo)},[t("div",Q,[t("span",X,r(n.prefijo),1),t("div",Y,[t("span",Z,r(n.nombre),1),t("span",$,r(a.getWaitingCount(n.codigo))+" en espera ",1)])]),t("div",tt,[t("button",{class:"call-next-btn",disabled:a.getWaitingCount(n.codigo)===0,onClick:T(c=>a.callNextTurn(n.codigo),["stop"])},[...e[18]||(e[18]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}),t("path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07"})],-1),u(" Llamar Siguiente ",-1)])],8,et)])],10,K))),128))])]),o.currentlyCallingTurn?(i(),l("section",st,[e[22]||(e[22]=t("h2",{class:"section-title calling"},[t("span",{class:"pulse-dot"}),u(" Turno en Atención ")],-1)),t("div",nt,[t("div",ot,r(o.currentlyCallingTurn.numero_turno),1),t("div",at,[t("span",rt,r(o.currentlyCallingTurn.nombre_area),1),o.currentlyCallingTurn.nombre_usuario?(i(),l("span",lt,r(o.currentlyCallingTurn.nombre_usuario),1)):h("",!0),t("span",it," Tiempo espera: "+r(o.currentlyCallingTurn.tiempo_espera_minutos||0)+" min ",1)]),t("div",ct,[t("button",{class:"complete-btn",onClick:e[0]||(e[0]=n=>a.completeTurn(o.currentlyCallingTurn.id))},[...e[20]||(e[20]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("polyline",{points:"9 11 12 14 22 4"}),t("path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"})],-1),u(" Completar Atención ",-1)])]),t("button",{class:"noshow-btn",onClick:e[1]||(e[1]=n=>a.cancelTurn(o.currentlyCallingTurn.id))},[...e[21]||(e[21]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("circle",{cx:"12",cy:"12",r:"10"}),t("line",{x1:"15",y1:"9",x2:"9",y2:"15"}),t("line",{x1:"9",y1:"9",x2:"15",y2:"15"})],-1),u(" No se Presentó ",-1)])])])])])):h("",!0),t("section",dt,[e[28]||(e[28]=t("h2",{class:"section-title"},[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M12 5v14M5 12h14"})]),u(" Generar Turno Manual ")],-1)),t("form",{onSubmit:e[5]||(e[5]=T((...n)=>a.createManualTurn&&a.createManualTurn(...n),["prevent"])),class:"create-turn-form"},[t("div",ut,[t("div",vt,[e[24]||(e[24]=t("label",null,"Área *",-1)),C(t("select",{"onUpdate:modelValue":e[2]||(e[2]=n=>o.newTurn.codigo_area=n),required:""},[e[23]||(e[23]=t("option",{value:""},"Seleccione área",-1)),(i(!0),l(x,null,w(o.areas,n=>(i(),l("option",{key:n.codigo,value:n.codigo},r(n.prefijo)+" - "+r(n.nombre),9,pt))),128))],512),[[k,o.newTurn.codigo_area]])]),t("div",ht,[e[25]||(e[25]=t("label",null,"DNI",-1)),C(t("input",{"onUpdate:modelValue":e[3]||(e[3]=n=>o.newTurn.dni_usuario=n),type:"text",maxlength:"8",placeholder:"DNI (opcional)"},null,512),[[b,o.newTurn.dni_usuario]])]),t("div",gt,[e[26]||(e[26]=t("label",null,"Nombre",-1)),C(t("input",{"onUpdate:modelValue":e[4]||(e[4]=n=>o.newTurn.nombre_usuario=n),type:"text",placeholder:"Nombre (opcional)"},null,512),[[b,o.newTurn.nombre_usuario]])]),t("button",{type:"submit",class:"generate-btn",disabled:o.creatingTurn},[...e[27]||(e[27]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("polyline",{points:"9 11 12 14 22 4"}),t("path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"})],-1),u(" Generar ",-1)])],8,yt)])],32)]),t("section",ft,[t("div",mt,[e[31]||(e[31]=m('<h2 class="section-title" data-v-c785975e><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-c785975e><line x1="8" y1="6" x2="21" y2="6" data-v-c785975e></line><line x1="8" y1="12" x2="21" y2="12" data-v-c785975e></line><line x1="8" y1="18" x2="21" y2="18" data-v-c785975e></line><line x1="3" y1="6" x2="3.01" y2="6" data-v-c785975e></line><line x1="3" y1="12" x2="3.01" y2="12" data-v-c785975e></line><line x1="3" y1="18" x2="3.01" y2="18" data-v-c785975e></line></svg> Turnos del Día </h2>',1)),t("div",Ct,[C(t("select",{"onUpdate:modelValue":e[6]||(e[6]=n=>o.filterArea=n),class:"filter-select"},[e[29]||(e[29]=t("option",{value:""},"Todas las áreas",-1)),(i(!0),l(x,null,w(o.areas,n=>(i(),l("option",{key:n.codigo,value:n.codigo},r(n.prefijo)+" - "+r(n.nombre),9,_t))),128))],512),[[k,o.filterArea]]),C(t("select",{"onUpdate:modelValue":e[7]||(e[7]=n=>o.filterStatus=n),class:"filter-select"},[...e[30]||(e[30]=[m('<option value="" data-v-c785975e>Todos los estados</option><option value="EN_ESPERA" data-v-c785975e>En Espera</option><option value="LLAMANDO" data-v-c785975e>Llamando</option><option value="ATENDIDO" data-v-c785975e>Atendido</option><option value="CANCELADO" data-v-c785975e>Cancelado</option>',5)])],512),[[k,o.filterStatus]])])]),t("div",xt,[t("table",wt,[e[37]||(e[37]=t("thead",null,[t("tr",null,[t("th",null,"Turno"),t("th",null,"Área"),t("th",null,"Usuario"),t("th",null,"Hora"),t("th",null,"Estado"),t("th",null,"Llamados"),t("th",null,"Acciones")])],-1)),t("tbody",null,[(i(!0),l(x,null,w(a.filteredTurns,n=>(i(),l("tr",{key:n.id,class:_("status-"+n.estado?.toLowerCase())},[t("td",kt,r(n.numero_turno),1),t("td",null,r(n.codigo_area),1),t("td",null,r(n.nombre_usuario||"Sin nombre"),1),t("td",null,r(n.hora_creacion?.substring(0,5)),1),t("td",null,[t("span",{class:_(["status-badge","status-"+n.estado?.toLowerCase()])},r(a.formatStatus(n.estado)),3)]),t("td",null,[n.estado==="LLAMANDO"||a.getCallCount(n.id)>0?(i(),l("div",Tt,[t("span",{class:_(["call-dot",{active:a.getCallCount(n.id)>=1}]),title:"1er llamado"},"1",2),t("span",{class:_(["call-dot",{active:a.getCallCount(n.id)>=2}]),title:"2do llamado"},"2",2)])):(i(),l("span",bt,"-"))]),t("td",At,[n.estado==="EN_ESPERA"?(i(),l("button",{key:0,class:"action-icon-btn call",onClick:c=>a.firstCall(n),title:"1er Llamado"},[...e[32]||(e[32]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}),t("path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07"})],-1)])],8,Et)):h("",!0),n.estado==="LLAMANDO"&&a.getCallCount(n.id)===1?(i(),l("button",{key:1,class:"action-btn-mini recall",onClick:c=>a.secondCall(n),title:"2do Llamado - RE-LLAMAR"},[...e[33]||(e[33]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}),t("path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07"}),t("path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14"})],-1),u(" Re-llamar ",-1)])],8,Mt)):h("",!0),n.estado==="LLAMANDO"&&a.getCallCount(n.id)>=2?(i(),l("div",Nt,[t("button",{class:"action-btn-mini complete",onClick:c=>a.completeTurn(n.id),title:"Atendido"},[...e[34]||(e[34]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("polyline",{points:"9 11 12 14 22 4"})],-1),u(" Atendido ",-1)])],8,Lt),t("button",{class:"action-btn-mini absent",onClick:c=>a.markAbsent(n.id),title:"Ausente"},[...e[35]||(e[35]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("circle",{cx:"12",cy:"12",r:"10"}),t("line",{x1:"15",y1:"9",x2:"9",y2:"15"}),t("line",{x1:"9",y1:"9",x2:"15",y2:"15"})],-1),u(" Ausente ",-1)])],8,Vt)])):h("",!0)])],2))),128)),a.filteredTurns.length===0?(i(),l("tr",Dt,[...e[36]||(e[36]=[t("td",{colspan:"7",class:"empty-row"},"No hay turnos para mostrar",-1)])])):h("",!0)])])])])])])}const Rt=A(E,[["render",Bt],["__scopeId","data-v-c785975e"]]);export{Rt as default};
