import{r as f,b,D as B,e as r,f as e,h as u,x as I,n as p,g as d,l as i,F as y,p as E,d as D,S as x,s as n}from"./index-D1dayd5A.js";const M={class:"container mx-auto px-4 py-8"},j={key:0,class:"bg-white rounded-xl shadow-md border border-gray-200 px-6 py-24 text-center"},L={key:1},O={class:"border-b border-gray-200 mb-6"},z={class:"-mb-px flex space-x-8"},V={key:0,class:"inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-white bg-yellow-500 rounded-full"},P={class:"space-y-6"},$={class:"bg-gradient-to-r from-slate-50 to-gray-100 px-6 py-4 border-b border-gray-200"},H={class:"flex flex-wrap items-center justify-between gap-4"},S={class:"flex items-center gap-4"},F={class:"text-lg font-bold text-gray-900"},q={class:"text-sm text-gray-500"},G={class:"flex items-center gap-3"},W={class:"p-6"},J={class:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6"},K={class:"font-semibold text-gray-900"},Q={class:"font-semibold text-gray-900"},R={class:"font-semibold text-gray-900"},U={class:"font-semibold text-gray-900 text-sm truncate"},X={class:"mb-6"},Y={class:"text-gray-700 bg-gray-50 p-3 rounded-lg"},Z={class:"mb-6"},ee={class:"flex items-center overflow-x-auto pb-2"},te={class:"flex flex-col items-center min-w-[120px]"},se={key:0,class:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},oe={key:1,class:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},re={key:2,class:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},ne={key:3,class:"text-xs font-bold"},ie={class:"mt-2 text-xs font-semibold text-gray-700"},ae={class:"text-[10px] text-gray-500"},le={key:0,class:"flex-1 h-1 bg-gray-300 mx-2 min-w-[40px] rounded"},de={key:0,class:"text-gray-400 text-sm"},ce={key:0,class:"mb-6 p-4 bg-slate-50 rounded-xl border border-slate-200"},ue={class:"flex items-start gap-3"},pe={class:"text-xs font-bold uppercase tracking-wider text-slate-500 mb-1"},xe={key:0},ge={key:1},me={class:"text-sm text-slate-700 leading-relaxed font-medium"},he={key:1,class:"flex gap-3 pt-4 border-t border-gray-200"},ve=["onClick"],fe=["onClick"],be={key:0,class:"text-center py-12 bg-white rounded-xl shadow-sm border border-gray-200"},ye={class:"mt-2 text-sm font-medium text-gray-900"},we={class:"mt-1 text-sm text-gray-500"},ke={key:0},_e={key:1},De={__name:"GestionCitas",setup(Ce){const g=f([]),m=f(!1),l=f("pending"),h=b(()=>g.value.filter(o=>o.estado==="PENDIENTE").sort((o,t)=>new Date(t.fecha+" "+t.hora)-new Date(o.fecha+" "+o.hora))),N=b(()=>g.value.filter(o=>o.estado!=="PENDIENTE").sort((o,t)=>new Date(t.fecha+" "+t.hora)-new Date(o.fecha+" "+o.hora))),w=b(()=>l.value==="pending"?h.value:N.value),A=o=>{if(!o)return"";try{return new Date(o).toLocaleDateString("es-PE",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"})}catch{return o}},k=o=>{if(o.historial&&Array.isArray(o.historial)&&o.historial.length>0){const t=[...o.historial].reverse().filter(s=>s.descripcion&&s.descripcion.trim()!=="Cita registrada");if(t.length>0)return t[0].descripcion}return""},v=async()=>{m.value=!0;try{const o=await D.get("/citas/");g.value=o.data.sort((t,s)=>new Date(s.created_at)-new Date(t.created_at))}catch(o){console.error("Error fetching citas",o),o.response?.status===401&&x.fire({icon:"warning",title:"Sesión expirada",text:"Por favor inicie sesión nuevamente"})}finally{m.value=!1}},_=async(o,t)=>{const s=t==="ATENDIDO"?"atender":"cancelar",a=t==="ATENDIDO"?"#16a34a":"#dc2626",{value:c,isConfirmed:T}=await x.fire({title:`¿Confirmar ${t}?`,text:`Escriba una breve observación para ${s} esta cita:`,input:"textarea",inputPlaceholder:"Ingrese el motivo u observación aquí...",inputAttributes:{"aria-label":"Ingrese su observación"},showCancelButton:!0,confirmButtonText:"Confirmar",cancelButtonText:"Volver",confirmButtonColor:a,inputValidator:C=>{if(!C&&t==="CANCELADO")return"Es obligatorio indicar un motivo para la cancelación"}});if(T)try{await D.put(`/citas/${o}/status`,{status:t,observacion:c||""}),await v(),x.fire({icon:"success",title:"Estado Actualizado",text:`La cita ha sido marcada como ${t.toLowerCase()}`,toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3})}catch{x.fire({icon:"error",title:"Error",text:"No se pudo actualizar el estado de la cita"})}};return B(()=>{v()}),(o,t)=>(n(),r("div",M,[e("div",{class:"sm:flex sm:items-center sm:justify-between mb-8"},[t[3]||(t[3]=e("div",null,[e("h1",{class:"text-3xl font-bold text-slate-900"},"Gestión de Citas"),e("p",{class:"mt-2 text-sm text-slate-700"},"Administra las reservas de citas realizadas por usuarios externos.")],-1)),e("div",{class:"mt-4 sm:mt-0"},[e("button",{onClick:v,class:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[...t[2]||(t[2]=[e("svg",{class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),u(" Actualizar ",-1)])])])]),m.value?(n(),r("div",j,[...t[4]||(t[4]=[I('<div class="flex flex-col items-center justify-center"><svg class="animate-spin h-12 w-12 text-blue-600 mb-4" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg><p class="text-lg font-medium text-slate-600">Cargando citas...</p></div>',1)])])):(n(),r("div",L,[e("div",O,[e("nav",z,[e("button",{onClick:t[0]||(t[0]=s=>l.value="pending"),class:p([l.value==="pending"?"border-yellow-500 text-yellow-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2 transition-colors"])},[t[5]||(t[5]=e("svg",{class:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),t[6]||(t[6]=u(" Pendientes ",-1)),h.value.length>0?(n(),r("span",V,i(h.value.length),1)):d("",!0)],2),e("button",{onClick:t[1]||(t[1]=s=>l.value="completed"),class:p([l.value==="completed"?"border-green-500 text-green-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2 transition-colors"])},[...t[7]||(t[7]=[e("svg",{class:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),u(" Finalizadas ",-1)])],2)])]),e("div",P,[(n(!0),r(y,null,E(w.value,s=>(n(),r("div",{key:s.id,class:"bg-white rounded-xl shadow-md border border-gray-200 overflow-hidden hover:shadow-lg transition-shadow"},[e("div",$,[e("div",H,[e("div",S,[t[8]||(t[8]=e("div",{class:"bg-blue-100 p-3 rounded-lg"},[e("svg",{class:"h-6 w-6 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})])],-1)),e("div",null,[e("h3",F,i(s.nombres)+" "+i(s.apellidos),1),e("p",q,"DNI: "+i(s.dni)+" | "+i(s.oficina),1)])]),e("div",G,[e("span",{class:p([{"bg-yellow-100 text-yellow-800 border-yellow-300":s.estado==="PENDIENTE","bg-green-100 text-green-800 border-green-300":s.estado==="ATENDIDO","bg-red-100 text-red-800 border-red-300":s.estado==="CANCELADO"},"px-4 py-2 rounded-full text-sm font-bold border"])},i(s.estado),3)])])]),e("div",W,[e("div",J,[e("div",null,[t[9]||(t[9]=e("p",{class:"text-xs text-gray-500 uppercase tracking-wider"},"Fecha",-1)),e("p",K,i(s.fecha),1)]),e("div",null,[t[10]||(t[10]=e("p",{class:"text-xs text-gray-500 uppercase tracking-wider"},"Hora",-1)),e("p",Q,i(s.hora),1)]),e("div",null,[t[11]||(t[11]=e("p",{class:"text-xs text-gray-500 uppercase tracking-wider"},"Celular",-1)),e("p",R,i(s.celular),1)]),e("div",null,[t[12]||(t[12]=e("p",{class:"text-xs text-gray-500 uppercase tracking-wider"},"Correo",-1)),e("p",U,i(s.correo),1)])]),e("div",X,[t[13]||(t[13]=e("p",{class:"text-xs text-gray-500 uppercase tracking-wider mb-1"},"Asunto",-1)),e("p",Y,i(s.asunto),1)]),e("div",Z,[t[17]||(t[17]=e("p",{class:"text-xs text-gray-500 uppercase tracking-wider mb-3"},"Historial de Estado",-1)),e("div",ee,[(n(!0),r(y,null,E(s.historial||[],(a,c)=>(n(),r(y,{key:c},[e("div",te,[e("div",{class:p([{"bg-yellow-500":a.estado==="PENDIENTE","bg-green-500":a.estado==="ATENDIDO","bg-red-500":a.estado==="CANCELADO","bg-blue-500":!["PENDIENTE","ATENDIDO","CANCELADO"].includes(a.estado)},"w-10 h-10 rounded-full flex items-center justify-center text-white shadow-lg"])},[a.estado==="PENDIENTE"?(n(),r("svg",se,[...t[14]||(t[14]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])])):a.estado==="ATENDIDO"?(n(),r("svg",oe,[...t[15]||(t[15]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):a.estado==="CANCELADO"?(n(),r("svg",re,[...t[16]||(t[16]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"},null,-1)])])):(n(),r("span",ne,i(c+1),1))],2),e("p",ie,i(a.estado),1),e("p",ae,i(A(a.fecha)),1)]),c<(s.historial||[]).length-1?(n(),r("div",le)):d("",!0)],64))),128)),!s.historial||s.historial.length===0?(n(),r("div",de," Sin historial de cambios ")):d("",!0)])]),s.estado!=="PENDIENTE"&&k(s)?(n(),r("div",ce,[e("div",ue,[e("div",{class:p([s.estado==="ATENDIDO"?"text-green-500":"text-red-500","mt-0.5"])},[...t[18]||(t[18]=[e("svg",{class:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)])],2),e("div",null,[e("p",pe,[s.estado==="ATENDIDO"?(n(),r("span",xe,"Observación de Atención")):(n(),r("span",ge,"Motivo de Cancelación"))]),e("p",me,i(k(s)),1)])])])):d("",!0),s.estado==="PENDIENTE"?(n(),r("div",he,[e("button",{onClick:a=>_(s.id,"ATENDIDO"),class:"flex-1 inline-flex items-center justify-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium"},[...t[19]||(t[19]=[e("svg",{class:"w-5 h-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),u(" Marcar como Atendido ",-1)])],8,ve),e("button",{onClick:a=>_(s.id,"CANCELADO"),class:"flex-1 inline-flex items-center justify-center px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-medium"},[...t[20]||(t[20]=[e("svg",{class:"w-5 h-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),u(" Cancelar Cita ",-1)])],8,fe)])):d("",!0)])]))),128)),w.value.length===0?(n(),r("div",be,[t[21]||(t[21]=e("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),e("h3",ye,i(l.value==="pending"?"No hay citas pendientes":"No hay citas finalizadas"),1),e("p",we,[l.value==="pending"?(n(),r("span",ke,"Las citas pendientes aparecerán aquí.")):(n(),r("span",_e,"Las citas atendidas o canceladas aparecerán aquí."))])])):d("",!0)])]))]))}};export{De as default};
